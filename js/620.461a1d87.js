"use strict";(self["webpackChunknewproject2"]=self["webpackChunknewproject2"]||[]).push([[620],{8620:function(t,e,a){a.r(e),a.d(e,{default:function(){return X}});var s=a(641),r=a(33),n=a(3751);const i={class:"navbar navbar-expand-lg bg-dark fixed-top","data-bs-theme":"dark"},o={class:"container-fluid"},l={class:"collapse navbar-collapse",id:"navbarText"},c={class:"navbar-nav me-auto mb-2 mb-lg-0"},d={class:"nav-item"},u={class:"nav-item"},h={class:"nav-item"},p={class:"navbar-nav ms-auto"},v={class:"cart-anchor"},g={key:0,class:"cart-badge badge rounded-pill bg-danger"},k={key:0,class:"cart-preview position-absolute bg-white text-dark border rounded shadow"},b=["src"],m={class:"flex-grow-1"},f={class:"fw-bold"},w={class:"text-dark small"},L=["onClick"],y={class:"p-2 text-center"},C={class:"title-list-container"},x={class:"news-box"},_={class:"news-list"},I=["href"],$={key:0,style:{color:"red"},class:"mt-3"};function E(t,e,a,E,F,j){const P=(0,s.g2)("Loading"),A=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(P,{active:F.isLoading},null,8,["active"]),(0,s.Lk)("nav",i,[(0,s.Lk)("div",o,[(0,s.bF)(A,{class:"navbar-brand",to:"/"},{default:(0,s.k6)(()=>e[0]||(e[0]=[(0,s.eW)(" 籃球瘋 ",-1)])),_:1,__:[0]}),e[6]||(e[6]=(0,s.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarText","aria-controls":"navbarText","aria-expanded":"false","aria-label":"Toggle navigation"},[(0,s.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,s.Lk)("div",l,[(0,s.Lk)("ul",c,[(0,s.Lk)("li",d,[(0,s.bF)(A,{class:"nav-link",to:"/about"},{default:(0,s.k6)(()=>e[1]||(e[1]=[(0,s.eW)("關於",-1)])),_:1,__:[1]})]),(0,s.Lk)("li",u,[(0,s.bF)(A,{class:"nav-link",to:"/frontproducts"},{default:(0,s.k6)(()=>e[2]||(e[2]=[(0,s.eW)("產品",-1)])),_:1,__:[2]})]),(0,s.Lk)("li",h,[(0,s.bF)(A,{class:"nav-link",to:"/news"},{default:(0,s.k6)(()=>e[3]||(e[3]=[(0,s.eW)("最新消息",-1)])),_:1,__:[3]})])]),(0,s.Lk)("ul",p,[(0,s.Lk)("span",(0,s.v6)({ref:"cartIcon",class:"cart-wrapper"},(0,s.Tb)(j.cartIconEvents,!0)),[(0,s.Lk)("div",v,[(0,s.bF)(A,{class:"nav-link cart-link",to:"/user/cart",style:{"margin-right":"0.5cm"}},{default:(0,s.k6)(()=>[e[4]||(e[4]=(0,s.eW)(" 購物車 ",-1)),j.cartQty>0?((0,s.uX)(),(0,s.CE)("span",g,(0,r.v_)(j.cartQty),1)):(0,s.Q3)("",!0)]),_:1,__:[4]})]),F.showCartPreview&&j.cartQty>0?((0,s.uX)(),(0,s.CE)("div",k,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(j.cartItems,t=>((0,s.uX)(),(0,s.CE)("div",{key:t.id,class:"d-flex align-items-center p-2 border-bottom"},[(0,s.Lk)("img",{src:t.product.imageUrl,alt:"商品圖片",class:"me-2",style:{width:"50px",height:"50px","object-fit":"cover"}},null,8,b),(0,s.Lk)("div",m,[(0,s.Lk)("div",f,(0,r.v_)(t.product.title),1),(0,s.Lk)("div",w,"數量: "+(0,r.v_)(t.qty),1)]),(0,s.Lk)("button",{class:"btn btn-sm btn-outline-danger ms-2",onClick:(0,n.D$)(e=>j.removeCartItem(t.id),["stop","prevent"])}," × ",8,L)]))),128)),(0,s.Lk)("div",y,[(0,s.bF)(A,{to:"/user/cart",class:"btn btn-sm btn-dark"},{default:(0,s.k6)(()=>e[5]||(e[5]=[(0,s.eW)(" 前往購物車 ",-1)])),_:1,__:[5]})])])):(0,s.Q3)("",!0)],16)])])])]),(0,s.Lk)("div",C,[e[7]||(e[7]=(0,s.Lk)("h2",{class:"fw-bold text-center mb-4"},"最新消息",-1)),(0,s.Lk)("div",x,[(0,s.Lk)("ul",_,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(F.posts,(t,e)=>((0,s.uX)(),(0,s.CE)("li",{key:e,class:"news-item"},[(0,s.Lk)("a",{href:j.getFirstLink(t),target:"_blank",rel:"noopener noreferrer",class:"news-title"},(0,r.v_)(t.postInfo.title),9,I)]))),128))]),F.error?((0,s.uX)(),(0,s.CE)("div",$,"錯誤："+(0,r.v_)(F.error),1)):(0,s.Q3)("",!0)])])],64)}var F=a(1600),j={name:"News",data(){return{products:[],isLoading:!1,cart:[],status:{loadingItem:""},showCartPreview:!1,files:["nba_6504.json","nba_6505.json"],posts:[],error:null}},computed:{cartQty(){return this.cart.reduce((t,e)=>t+e.qty,0)},cartItems(){return this.cart},cartIconEvents(){return{mouseenter:()=>{this.showCartPreview=!0},mouseleave:()=>{this.showCartPreview=!1}}}},mounted(){this.loadAllJsonFiles(),document.addEventListener("click",this.handleOutsideClick),F.A.on("update-cart",this.getCart),this.getProducts(),this.getCart()},methods:{async loadAllJsonFiles(){try{const t=this.files.map(t=>fetch(t).then(e=>{if(!e.ok)throw new Error(`${t} 載入失敗`);return e.json()})),e=await Promise.all(t);e.forEach(t=>{t.forEach(t=>{t.postInfo?.title&&"unknown"!==t.postInfo.title&&this.posts.push(t)})})}catch(t){this.error=t.message,alert("載入失敗："+t.message)}},getFirstLink(t){const e=t.contentInfo?.link||[],a=t.contentInfo?.image||[],s=e.filter(t=>!a.includes(t));return s[0]||e[0]||"#"},getProducts(){const t="https://vue3-course-api.hexschool.io/api/lienjackson/products/all";this.isLoading=!0,this.$http.get(t).then(t=>{this.products=t.data.products,this.isLoading=!1})},getProduct(t){this.$router.push(`/user/product/${t}`)},animateToCart(t){const e=t.target.closest(".card"),a=e?.querySelector(".card-img-top"),s=this.$refs.cartIcon;if(!a||!s)return void console.warn("動畫失敗：無法找到圖片或購物車圖示");const r=a.cloneNode(!0),n=a.getBoundingClientRect(),i=s.getBoundingClientRect();r.style.position="fixed",r.style.left=`${n.left}px`,r.style.top=`${n.top}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,r.style.zIndex=1e3,r.style.transition="all 0.8s ease-in-out",document.body.appendChild(r),requestAnimationFrame(()=>{r.style.left=`${i.left}px`,r.style.top=`${i.top}px`,r.style.width="0px",r.style.height="0px",r.style.opacity="0.5"}),r.addEventListener("transitionend",()=>{r.remove()})},addCart(t,e){const a="https://vue3-course-api.hexschool.io/api/lienjackson/cart";this.status.loadingItem=t;const s={product_id:t,qty:1};this.animateToCart(e),this.$http.post(a,{data:s}).then(()=>{this.status.loadingItem="",this.getCart()}).catch(()=>{this.status.loadingItem="",alert("加入購物車失敗，請稍後再試")})},getCart(){const t="https://vue3-course-api.hexschool.io/api/lienjackson/cart";this.isLoading=!0,this.$http.get(t).then(t=>{t.data&&t.data.data&&Array.isArray(t.data.data.carts)?this.cart=t.data.data.carts:this.cart=[],this.isLoading=!1}).catch(()=>{this.cart=[],this.isLoading=!1})},removeCartItem(t){const e=`https://vue3-course-api.hexschool.io/api/lienjackson/cart/${t}`;this.$http.delete(e).then(()=>{this.cart=this.cart.filter(e=>e.id!==t)}).catch(()=>{alert("刪除商品失敗，請稍後再試")})},handleOutsideClick(t){const e=this.$refs.cartIcon;e&&!e.contains(t.target)&&(this.showCartPreview=!1)}},beforeUnmount(){document.removeEventListener("click",this.handleOutsideClick),F.A.off("update-cart",this.getCart)}},P=a(6262);const A=(0,P.A)(j,[["render",E]]);var X=A}}]);
//# sourceMappingURL=620.461a1d87.js.map